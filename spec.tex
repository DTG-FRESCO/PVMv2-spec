%%%% University of Cambridge tech-report formatting; enable when producing
%%%% tech-report versions of these documents; otherwise, disable.
\documentclass[12pt,twoside,a4paper]{article}
\setlength{\oddsidemargin}{-0.4mm} % 25 mm left margin
\setlength{\evensidemargin}{\oddsidemargin}
\setlength{\textwidth}{160mm}      % 25 mm right margin
\setlength{\topmargin}{-5.4mm}     % 20 mm top margin
\setlength{\headheight}{5mm}
\setlength{\headsep}{5mm}
\setlength{\footskip}{10mm}
\setlength{\textheight}{237mm}     % 20 mm bottom margin
%%%% .. or regular document
%\documentclass[12pt,letterpaper,twoside,openright,fleqn]{report}
%%%% End of tech-report vs. regular
%%%%

\usepackage{graphicx}
\usepackage{tikz}
\usepackage{tikz-uml}
\usepackage[hidelinks]{hyperref}

\newcommand{\Entity}{\hyperref[sec:ty:Entity]{Entity}}

\begin{document}
\title{PVMv2 Specification}
\author{Thomas Bytheway \and Lucian Carata}

\maketitle

\clearpage

\section{Introduction}

\section{Abstract Types}
\label{sec:ty}
The PVMv2 model defines a number of different abstract types which are used to both represent data in the resulting graph format, and as a basis for deriving concrete types to represent real trace entities. Figure~\ref{fig:types} shows a UML representation of the different types and how they are related. Below we will go into more detail on each of the types in turn.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\umlsimpleclass{Entity}
\umlsimpleclass[y=-2, x=2]{Actor}
\umlsimpleclass[y=-2, x=-2]{Object}
\umlsimpleclass[y=-4, x=-0.5]{Store}
\umlsimpleclass[y=-4, x=-3.5]{ChannelEP}
\umlinherit[geometry=|-|]{Actor}{Entity}
\umlinherit[geometry=|-|]{Object}{Entity}
\umlinherit[geometry=|-|]{Store}{Object}
\umlinherit[geometry=|-|]{ChannelEP}{Object}
\end{tikzpicture}
\caption{A diagram of the basic abstract types in PVMv2}
\label{fig:types}
\end{figure}

\paragraph{Entity}
\label{sec:ty:entity}
 is the root abstract type. The common feature of all entities is that they possess a uniquely identifying name that is either totally unique for some subtypes, or is maintained for version chains for other subtypes. In general concrete types should not be derived from Entity unless there is no better option available.

\paragraph{Actor}
\label{sec:ty:actor}
 entities are active entities that perform actions, generally processing units such as unix processes, though they can also represent more abstract notions of processing. They are directly comparable to subjects in the orange book. They act upon objects, or other actors.

\paragraph{Object}
Passive entities that are acted upon by actors. Generally data carrying entities.

\paragraph{Store}
Object type that stores data internally. Versions from first write to last write, using EditSessions.

\paragraph{ChannelEP}
Object type that data flows through without internal storage. Does not version. May participate in connections.

\section{Graph Schema}

\subsection{Nodes}

\begin{figure}[h]
\centering
\begin{tikzpicture}
    \umlclass[type=abstract]{Node}{db\_id:ID}{}
    \umlclass[x=-2, y=-3, type=abstract]{Name}{ctx:ID}{}
    \umlclass[x=-6, y=-6]{Path}{path:String}{}
    \umlclass[x=-2, y=-6]{Net}{addr:String \\ port:int32}{}
    \umlclass[x=2, y=-3]{Entity}{ty:String \\ uuid:Uuid \\ ctx:ID}{}
    \umlclass[x=6, y=-3]{Type}{name:String \\ abstract:String \\ schema:[String]}{}
    \umlsimpleclass[x=-6, y=-3, type=schema]{Context}
    \umlsimpleclass[x=2, y=-6, type=schema]{Object}
    \umlsimpleclass[x=6, y=-6, type=schema]{Actor}
    \umlsimpleclass[x=2, y=-8, type=schema]{Store}
    \umlsimpleclass[x=6, y=-8, type=schema]{Channel}
    \umlinherit[geometry=|-|, weight=0.55]{Name}{Node}
    \umlinherit[geometry=|-|]{Path}{Name}
    \umlinherit[geometry=|-|]{Net}{Name}
    \umlinherit[geometry=|-|, weight=0.55]{Entity}{Node}
    \umlinherit[geometry=|-|, weight=0.55]{Type}{Node}
    \umlinherit[geometry=|-|, weight=0.55]{Context}{Node}
    \umlinherit[geometry=|-|]{Object}{Entity}
    \umlinherit[geometry=|-|, weight=0.3]{Actor}{Entity}
    \umlinherit[geometry=|-|]{Store}{Object}
    \umlinherit[geometry=|-|]{Channel}{Object}
\end{tikzpicture}
\caption{A diagram of the potential nodes in a PVMv2 database.}
\end{figure}

\subsubsection{Schema Nodes}

\subsubsection{Context Nodes}

\subsubsection{Entity Nodes}

\subsubsection{Non-canonical Names}

\paragraph{Path Names}

\paragraph{Network Addresses}

\subsection{Relations}

\begin{figure}[!h]
\centering
\begin{tikzpicture}
    \umlclass[type=abstract]{Rel}{db\_id:ID}{}
    \umlclass[x=3, y=-3]{INF}{ctx:ID \\ pvm\_op:String}{}
    \umlclass[x=-3, y=-3]{NAMED}{start:ID \\ end:Option\textless ID\textgreater}{}
    \umlinherit[geometry=|-|]{INF}{Rel}
    \umlinherit[geometry=|-|]{NAMED}{Rel}
\end{tikzpicture}
\caption{A diagram of the potential relations in a PVMv2 database.}
\end{figure}

\paragraph{INF}
Indicates that the source has potentially imparted data or control to the destination.

\paragraph{NAMED}
Indicates that the source has been mentioned by the destination non-canonical name.

\section{Mappings}

\subsection{Concrete Type Declaration}

\subsection{Verbs}

\paragraph{Declare}
Forces the creation of entity if it does not already exist.

\paragraph{Sink}
Called when as part of a mapped function, an actor sinks data to an entity as an ‘atomic’ operation.
Causes Stores to version, creating a new Store entity connected to the previous one by an INF relation.
Creates an INF relation from actor to entity. 

\paragraph{Source}
Called when as part of a mapped function, an actor sources data from an entity.
Creates an INF relation from entity to actor.

\paragraph{Connect}
Called as part of a mapped function to declare that two channel nodes are connected to each other and that data can flow between them. The dir argument indicates the direction of flow, either mono or bi. Mono indicates that data may only flow from the first channel to the second, bi indicates that data may flow in both directions. 

\paragraph{Mention}

\paragraph{Unlink}

\paragraph{Property}

\section{A Worked Example}

\end{document}
